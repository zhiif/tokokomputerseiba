<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Dashboard Admin{% endblock %}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      /* Variabel Global untuk Konsistensi Desain */
      :root {
        --header-height: 0rem; /* Header tidak ada, set ke 0 */
        --nav-width: 250px;
        --nav-width-collapsed: 60px; /* Lebar sidebar saat tertutup (hanya ikon) */
        --body-font: "Nunito", sans-serif;
        --normal-font-size: 1rem;
        --z-fixed: 100;

        /* --- Variabel untuk Efek Transparan (Glassmorphism) pada Sidebar --- */
        --sidebar-bg-rgb: 255, 255, 255; /* RGB dasar untuk transparansi (putih) */
        --sidebar-bg-alpha: 0.15; /* Tingkat transparansi (0.0 - 1.0) */
        --sidebar-border-color: rgba(
          255,
          255,
          255,
          0.1
        ); /* Warna border transparan */
        --sidebar-shadow-color: rgba(
          106,
          0,
          255,
          0.3
        ); /* Warna bayangan ungu (dari pedoman user) */
        --sidebar-text-color: #f8f9fa; /* Warna teks putih keabu-abuan (dari pedoman user) */
        --sidebar-link-hover-bg: rgba(
          255,
          255,
          255,
          0.05
        ); /* Background hover lebih terang (dari pedoman user) */
        --sidebar-link-hover-color: #a879ff; /* Warna teks hover ungu terang (dari pedoman user) */
        --sidebar-active-bg: #8a2be2; /* Warna background link aktif (biru keunguan dari pedoman user) */

        /* Warna untuk teks 'Admin Panel' */
        --admin-panel-text-color: #ffffff; /* Putih bersih */
        --admin-panel-font-size: 1.25rem;
        --admin-panel-font-weight: 700;

        /* Variabel untuk tombol toggle global di mobile */
        --mobile-toggle-bg: rgba(
          106,
          0,
          255,
          0.7
        ); /* Background ungu transparan */
        --mobile-toggle-color: #f8f9fa; /* Warna ikon putih */
        --mobile-toggle-shadow: 0 2px 10px rgba(106, 0, 255, 0.5); /* Shadow ungu */

        /* --- Variabel untuk Scrollbar Custom --- */
        --scrollbar-thumb-color: #8a2be2; /* Ungu gelap */
        --scrollbar-track-color: rgba(
          0,
          0,
          0,
          0.1
        ); /* Track lebih transparan */
        --scrollbar-thumb-hover-color: #a879ff; /* Ungu terang saat hover */
        --scrollbar-width: 8px; /* Lebar scrollbar */
        --scrollbar-border-radius: 5px; /* Border radius scrollbar */

        /* Profile Menu Specific Variables */
        --profile-menu-font-family: "Inter", sans-serif;
        --profile-menu-spacing: 16px; /* Keep this for general use */
        --profile-menu-radius: 7px; /* Adjusted for consistency with sidebar */
        --profile-menu-transition-speed: 0.3s;

        /* Light theme colors (adapted for sidebar) */
        --profile-light-panel-bg: rgba(
          var(--sidebar-bg-rgb),
          var(--sidebar-bg-alpha)
        );
        --profile-light-card-bg: rgba(
          255,
          255,
          255,
          0.1
        ); /* Slightly more opaque for card */
        --profile-light-text-primary: var(--sidebar-text-color);
        --profile-light-text-secondary: rgba(
          248,
          249,
          250,
          0.7
        ); /* Slightly darker for secondary text */
        --profile-light-icon-color: var(--sidebar-text-color);
        --profile-light-hover-bg: var(--sidebar-link-hover-bg);
        --profile-light-link-highlight: var(--sidebar-link-hover-color);

        /* Dark theme colors (adapted for sidebar) */
        --profile-dark-panel-bg: rgba(30, 30, 30, 0.8);
        --profile-dark-card-bg: rgba(42, 42, 42, 0.8);
        --profile-dark-text-primary: #f0f0f0;
        --profile-dark-text-secondary: #888888;
        --profile-dark-icon-color: #f0f0f0cc;
        --profile-dark-hover-bg: rgba(74, 21, 12, 0.7);
        --profile-dark-link-highlight: #ff5722; /* Retain original highlight for contrast */
      }

      /* Styling Scrollbar (untuk WebKit browsers seperti Chrome, Safari, Edge) */
      /* Global scrollbar for the entire page */
      ::-webkit-scrollbar {
        width: var(--scrollbar-width);
        height: var(--scrollbar-width); /* Untuk scrollbar horizontal */
      }

      ::-webkit-scrollbar-track {
        background: var(--scrollbar-track-color);
        border-radius: var(--scrollbar-border-radius);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--scrollbar-thumb-color);
        border-radius: var(--scrollbar-border-radius);
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--scrollbar-thumb-hover-color);
      }

      /* Styling Scrollbar untuk Firefox */
      /* Target elemen yang mungkin memiliki scrollbar, contoh: body, main-wrapper, main-content */
      body,
      .main-wrapper,
      .main-content,
      .table-responsive-wrapper {
        scrollbar-width: thin; /* 'auto' atau 'thin' */
        scrollbar-color: var(--scrollbar-thumb-color)
          var(--scrollbar-track-color); /* thumb track */
      }

      /* Body umum */
      body {
        margin: 0;
        font-family: var(--body-font);
        font-size: var(--normal-font-size);
        /* Background gradasi yang sama dengan halaman user untuk konsistensi */
        background: linear-gradient(
          to right,
          #6a00f2,
          #7b00e0,
          #8a2be2
        ); /* Gradasi ungu-biru */
        overflow-x: hidden; /* Sembunyikan scrollbar horizontal secara default (desktop) */
        color: #333; /* Warna teks default untuk konten utama */
      }

      /* Semua elemen dengan transisi */
      * {
        box-sizing: border-box;
        transition: all 0.3s ease;
      }

      /* Hapus header karena tidak digunakan */
      .header {
        display: none;
      }

      /* Sidebar (L-navbar) */
      .l-navbar {
        position: fixed;
        top: 0;
        left: -250px; /* Default: tertutup di mobile */
        width: var(--nav-width);
        height: 100vh;
        /* Menggunakan variabel untuk transparansi dengan efek glassmorphism */
        background-color: rgba(var(--sidebar-bg-rgb), var(--sidebar-bg-alpha));
        backdrop-filter: blur(10px) saturate(150%); /* Efek blur kaca dari pedoman user */
        -webkit-backdrop-filter: blur(10px) saturate(150%);
        border-right: 1px solid var(--sidebar-border-color); /* Border transparan */
        padding-top: 1rem; /* Sesuaikan padding atas karena tidak ada header */
        z-index: var(--z-fixed);
        box-shadow: 2px 0 10px var(--sidebar-shadow-color); /* Bayangan dengan warna ungu */
        transition: left 0.3s ease, width 0.3s ease, background-color 0.4s ease,
          border-color 0.4s ease, box-shadow 0.4s ease,
          backdrop-filter 0.4s ease; /* Transisi untuk hover */
        display: flex; /* Make it a flex container */
        flex-direction: column; /* Stack items vertically */
      }

      /* Animasi hover untuk sidebar */
      .l-navbar:hover {
        background-color: var(
          --sidebar-link-hover-bg
        ); /* Menggunakan variabel hover bg */
        border-color: rgba(
          255,
          255,
          255,
          0.3
        ); /* Border lebih terlihat saat hover */
        box-shadow: 2px 0 15px rgba(106, 0, 255, 0.5); /* Shadow lebih kuat saat hover */
        backdrop-filter: blur(15px) saturate(180%); /* Blur lebih kuat saat hover */
        -webkit-backdrop-filter: blur(15px) saturate(180%);
      }

      /* Kelas untuk sidebar saat terbuka (baik di mobile maupun desktop) */
      .l-navbar.show {
        left: 0;
      }

      /* Kelas untuk sidebar saat tertutup (di desktop, menyisakan ikon) */
      .l-navbar.collapsed {
        width: var(--nav-width-collapsed);
        padding-left: 0.1rem; /* Sesuaikan padding agar ikon di tengah */
        padding-right: 0.5rem;
      }

      .nav {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 100%;
      }

      /* Logo/Nama Admin Panel di dalam sidebar (sekarang sebagai nav_logo) */
      .nav_logo {
        display: flex; /* Penting untuk flexbox internal */
        align-items: center;
        font-weight: var(--admin-panel-font-weight);
        font-size: var(--admin-panel-font-size);
        color: var(--admin-panel-text-color);
        padding: 1rem; /* Sama dengan nav_link */
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--sidebar-border-color);
        margin-bottom: 1rem;
        cursor: pointer; /* Menandakan ini interaktif */
        text-decoration: none; /* Hapus underline default link */
      }

      .nav_logo .admin-panel-text {
        white-space: nowrap;
        overflow: hidden;
        margin-right: 1rem; /* Jarak antara teks dan ikon toggle */
        transition: opacity 0.3s ease, width 0.3s ease, margin-right 0.3s ease;
      }

      .nav_logo .bx-menu {
        font-size: 1.5rem; /* Ukuran ikon toggle */
        transition: margin-right 0.3s ease;
      }

      /* State collapsed untuk nav_logo (desktop) */
      .l-navbar.collapsed .nav_logo .admin-panel-text {
        opacity: 0;
        width: 0;
        margin-right: 0; /* Hilangkan margin saat teks tersembunyi */
      }

      .l-navbar.collapsed .nav_logo .bx-menu {
        margin-left: auto; /* Pusatkan ikon di mode collapsed */
        margin-right: auto;
      }

      .nav_link {
        display: flex;
        align-items: center;
        color: var(--sidebar-text-color); /* Warna teks untuk link */
        padding: 1rem;
        text-decoration: none;
        overflow: hidden; /* Sembunyikan teks saat sidebar collapsed */
        transition: color 0.3s ease-in-out, background-color 0.3s ease-in-out; /* Transisi untuk hover */
      }

      .nav_link:hover {
        background-color: var(
          --sidebar-link-hover-bg
        ); /* Background hover transparan */
        color: var(--sidebar-link-hover-color); /* Warna teks hover */
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); /* Glow putih saat hover */
      }

      .nav_logo-icon, /* Ini mungkin tidak lagi dipakai jika ikon di nav_logo terpisah */
      .nav_icon {
        margin-right: 1rem;
        font-size: 1.25rem;
      }

      .l-navbar.collapsed .nav_icon {
        margin-right: 0; /* Hapus margin agar ikon lebih ke tengah */
      }

      .nav_name {
        white-space: nowrap; /* Cegah teks pindah baris */
      }

      .l-navbar.collapsed .nav_name {
        display: none; /* Sembunyikan nama link saat sidebar collapsed */
      }

      /* Link aktif styling */
      .nav_list a.active {
        background-color: var(
          --sidebar-active-bg
        ); /* Background link aktif (ungu) */
        border-radius: 0.5rem; /* Sedikit lengkungan pada link aktif */
        font-weight: 600; /* Tebal untuk link aktif */
        color: var(
          --sidebar-link-hover-color
        ); /* Warna ungu terang untuk teks aktif */
        text-shadow: 0 0 3px rgba(255, 255, 255, 0.3); /* Glow halus untuk teks aktif */
      }

      /* NEW: Tombol toggle global yang selalu terlihat di mobile */
      .mobile-top-toggle {
        position: fixed;
        top: 1rem; /* Dari atas */
        left: 1rem; /* Dari kiri */
        background-color: var(--mobile-toggle-bg);
        color: var(--mobile-toggle-color);
        padding: 0.6rem;
        border-radius: 50%; /* Bentuk lingkaran */
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: var(--z-fixed) + 1; /* Pastikan di atas sidebar */
        box-shadow: var(--mobile-toggle-shadow);
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
      }
      .mobile-top-toggle i {
        font-size: 1.5rem;
      }
      .mobile-top-toggle:hover {
        background-color: rgba(
          106,
          0,
          255,
          0.9
        ); /* Sedikit lebih gelap saat hover */
        box-shadow: 0 4px 20px rgba(106, 0, 255, 0.7);
      }

      /* Main Wrapper */
      .main-wrapper {
        margin-top: 0; /* Tidak ada header, jadi margin-top 0 */
        margin-left: 0; /* Default ke 0 */
        transition: margin-left 0.3s ease;
        min-height: 100vh; /* Sesuaikan tinggi agar mengisi seluruh viewport */
        padding-top: 1.5rem; /* Padding konten */
        max-width: 100%; /* Pastikan tidak melebihi lebar */
      }

      /* Pergeseran main-wrapper saat sidebar terbuka */
      .main-wrapper.shifted {
        margin-left: var(--nav-width); /* Geser sejauh lebar sidebar penuh */
      }

      .main-wrapper.shifted-collapsed {
        margin-left: var(
          --nav-width-collapsed
        ); /* Geser sejauh lebar sidebar collapsed */
      }

      /* Overlay */
      .overlay {
        position: fixed;
        top: 0; /* Mulai dari paling atas karena tidak ada header */
        left: 0;
        width: 100%;
        height: 100%; /* Isi seluruh viewport */
        background-color: rgba(0, 0, 0, 0.4);
        z-index: 50;
        opacity: 0;
        transition: 0.3s ease;
        visibility: hidden; /* Tambahkan visibility agar tidak interaktif saat tidak aktif */
      }

      .overlay.active {
        opacity: 1;
        visibility: visible;
      }

      /* Konten utama */
      .main-content {
        padding: 1.5rem;
        color: #333; /* Warna teks yang kontras dengan background body */
        background-color: var(
          --white-color
        ); /* Kembali ke putih sesuai yang Anda inginkan sebelumnya */
        margin: 1.5rem; /* Margin di sekitar konten */
        border-radius: 0.75rem; /* Sudut membulat */
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* Bayangan ringan */
        /* Sembunyikan overflow horizontal secara default untuk desktop */
        overflow-x: hidden;
      }

      /* --- Profile Menu Styling (integrated and adapted) --- */
      .profile-menu {
        position: relative; /* Needed for positioning the dropdown */
        padding: 0; /* Keep this 0 */
        margin-top: auto; /* Push to the bottom */
        width: 100%;
      }

      .profile-card {
        background-color: transparent; /* Default: transparent */
        backdrop-filter: none; /* Default: no glass effect */
        -webkit-backdrop-filter: none;
        border: 1px solid rgba(255, 255, 255, 0.3); /* Border tipis untuk light theme */
        border-radius: var(--profile-menu-radius);
        text-align: center;
        padding: 10px var(--profile-menu-spacing); /* Adjusted to 10px top/bottom for compactness */
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1); /* Ditambahkan shadow tipis untuk light theme */
        transition: background-color var(--profile-menu-transition-speed),
          color var(--profile-menu-transition-speed),
          box-shadow var(--profile-menu-transition-speed),
          backdrop-filter var(--profile-menu-transition-speed),
          border-color var(--profile-menu-transition-speed);
        cursor: pointer;
      }

      /* Add back image styling */
      .profile-card img {
        width: 72px; /* Set to 72px originally */
        height: 72px; /* Set to 72px originally */
        border-radius: 50%; /* THIS IS THE KEY FOR CIRCLE */
        object-fit: cover;
        margin-bottom: 8px; /* Reduced space between image and text */
        transition: width 0.3s ease, height 0.3s ease, margin 0.3s ease; /* Ensure smooth transition */
      }

      /* Reset margins and adjust font sizes for text elements inside profile card */
      .profile-card h2 {
        margin: 0; /* Remove default margins */
        font-size: 1rem; /* Smaller font for name */
        line-height: 1.2; /* Compact line height */
        font-weight: 600;
      }
      .profile-card p {
        margin: 0; /* Remove default margins */
        font-size: 0.85rem; /* Smaller font for followers count */
        line-height: 1.2; /* Compact line height */
        color: var(
          --profile-light-text-secondary
        ); /* Use secondary text color */
      }

      /* Dark mode styling for profile card */
      body.dark-mode .profile-card {
        background-color: transparent;
        backdrop-filter: blur(8px) saturate(180%); /* Glassmorphism di dark mode */
        -webkit-backdrop-filter: blur(8px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.15); /* Border lebih subtle di dark mode */
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.3); /* Ditambahkan shadow tipis untuk dark theme */
        color: var(
          --profile-dark-text-primary
        ); /* Pastikan teks tetap terbaca */
      }
      body.dark-mode .profile-card p {
        color: var(
          --profile-dark-text-secondary
        ); /* Pastikan teks secondary tetap terbaca */
      }

      /* Hide text and adjust image when sidebar is collapsed */
      .l-navbar.collapsed .profile-card h2,
      .l-navbar.collapsed .profile-card p {
        display: none;
      }
      .l-navbar.collapsed .profile-card img {
        width: 40px;
        height: 40px;
        margin-bottom: 0;
        margin-left: auto;
        margin-right: auto;
      }

      /* Remove background, shadow, and border from profile card when sidebar is collapsed */
      .l-navbar.collapsed .profile-card {
        background: transparent;
        box-shadow: none; /* Dihilangkan shadow saat collapsed */
        border-radius: 0;
        padding: 10px 0.5rem; /* Maintain vertical padding for collapsed state */
        backdrop-filter: none; /* Selalu tanpa backdrop-filter saat collapsed */
        -webkit-backdrop-filter: none;
        border: none; /* Tanpa border saat collapsed */
      }

      /* Profile Dropdown Content Container */
      .profile-dropdown-content {
        position: absolute;
        bottom: 100%;
        left: 0;
        width: 100%;
        background: transparent; /* Default: transparent */
        backdrop-filter: none; /* Default: no glass effect */
        -webkit-backdrop-filter: none;
        border: 1px solid rgba(255, 255, 255, 0.3); /* Border tipis untuk light theme */
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* Ditambahkan shadow untuk light theme */
        border-radius: var(--profile-menu-radius);
        transform: translateX(-100%);
        opacity: 0;
        visibility: hidden;
        transition: transform 0.3s ease-out, opacity 0.3s ease-out,
          visibility 0s 0.3s, background var(--profile-menu-transition-speed),
          backdrop-filter var(--profile-menu-transition-speed),
          border-color var(--profile-menu-transition-speed),
          box-shadow var(--profile-menu-transition-speed);
        z-index: var(--z-fixed) - 1;
      }

      .profile-dropdown-content.active {
        transform: translateX(0);
        opacity: 1;
        visibility: visible;
        transition: transform 0.3s ease-out, opacity 0.3s ease-out,
          visibility 0s 0s;
      }

      /* Dark mode styling for profile dropdown content */
      body.dark-mode .profile-dropdown-content {
        background: transparent; /* Transparan di dark mode */
        backdrop-filter: blur(10px) saturate(150%); /* Glassmorphism di dark mode */
        -webkit-backdrop-filter: blur(10px) saturate(150%);
        border: 1px solid rgba(255, 255, 255, 0.15); /* Border lebih subtle di dark mode */
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); /* Ditambahkan shadow untuk dark theme */
      }

      /* Menu List inside dropdown */
      .profile-dropdown-content nav {
        display: flex;
        flex-direction: column;
        padding: 0 0.5rem;
      }
      .profile-dropdown-content nav button,
      .profile-dropdown-content nav a {
        all: unset;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 0.75rem 1rem;
        font-weight: 600;
        font-size: var(--normal-font-size);
        color: var(--profile-light-text-primary);
        border-radius: 0.5rem;
        transition: background var(--profile-menu-transition-speed),
          color var(--profile-menu-transition-speed);
        width: 100%;
        box-sizing: border-box;
        text-decoration: none;
      }
      .profile-dropdown-content nav button:hover,
      .profile-dropdown-content nav button:focus-visible,
      .profile-dropdown-content nav a:hover,
      .profile-dropdown-content nav a:focus-visible {
        background: var(--profile-light-hover-bg);
        color: var(--profile-light-link-highlight);
        outline-offset: 2px;
        outline: 2px solid var(--profile-light-link-highlight);
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
      }
      body.dark-mode .profile-dropdown-content nav button:hover,
      body.dark-mode .profile-dropdown-content nav button:focus-visible,
      body.dark-mode .profile-dropdown-content nav a:hover,
      body.dark-mode .profile-dropdown-content nav a:focus-visible {
        background: var(--profile-dark-hover-bg);
        color: var(--profile-dark-link-highlight);
      }
      .profile-dropdown-content nav button.active,
      .profile-dropdown-content nav a.active {
        background: var(--sidebar-active-bg);
        color: var(--profile-light-link-highlight);
        font-weight: 600;
        text-shadow: 0 0 3px rgba(255, 255, 255, 0.3);
      }
      body.dark-mode .profile-dropdown-content nav button.active,
      body.dark-mode .profile-dropdown-content nav a.active {
        background: var(--profile-dark-hover-bg);
        color: var(--profile-dark-link-highlight);
      }

      /* Hide text when sidebar is collapsed */
      .l-navbar.collapsed .profile-dropdown-content nav button .switch-label,
      .l-navbar.collapsed
        .profile-dropdown-content
        nav
        button
        span:not(.material-icons),
      .l-navbar.collapsed
        .profile-dropdown-content
        nav
        a
        span:not(.material-icons) {
        display: none;
      }
      /* Center icons when sidebar is collapsed */
      .l-navbar.collapsed .profile-dropdown-content nav button .material-icons,
      .l-navbar.collapsed .profile-dropdown-content nav a .material-icons {
        margin: auto;
      }

      /* Icons for profile menu */
      .profile-dropdown-content .material-icons {
        font-size: 1.25rem;
        color: inherit;
        flex-shrink: 0;
        margin-right: 1rem;
      }
      /* Remove margin for icons in collapsed state */
      .l-navbar.collapsed .profile-dropdown-content .material-icons {
        margin-right: 0;
      }

      /* Switch container */
      .profile-dropdown-content .switch-label {
        flex-grow: 1;
      }

      /* Toggle switch */
      .profile-dropdown-content .switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 24px;
      }
      .profile-dropdown-content .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .profile-dropdown-content .slider {
        position: absolute;
        cursor: pointer;
        background-color: #ccc;
        border-radius: 12px;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        transition: background-color var(--profile-menu-transition-speed);
      }
      .profile-dropdown-content .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        border-radius: 50%;
        transition: transform var(--profile-menu-transition-speed);
      }
      .profile-dropdown-content input:checked + .slider {
        background-color: var(--profile-light-link-highlight);
      }
      body.dark-mode .profile-dropdown-content input:checked + .slider {
        background-color: var(--profile-dark-link-highlight);
      }
      .profile-dropdown-content input:checked + .slider:before {
        transform: translateX(20px);
      }

      /* Divider and footer */
      .profile-dropdown-content .divider {
        border-top: 1px solid var(--sidebar-border-color);
        margin: var(--profile-menu-spacing) 0.5rem;
      }
      body.dark-mode .profile-dropdown-content .divider {
        border-color: rgba(255, 255, 255, 0.2);
      }
      .profile-dropdown-content .footer {
        font-size: 0.75rem;
        color: var(--profile-light-text-secondary);
        text-align: center;
        padding-bottom: var(--profile-menu-spacing);
        user-select: none;
        padding-left: 0.5rem;
        padding-right: 0.5rem;
      }
      body.dark-mode .profile-dropdown-content .footer {
        color: var(--profile-dark-text-secondary);
      }
      .profile-dropdown-content .footer a {
        color: inherit;
        text-decoration: none;
        margin: 0 6px;
      }
      .profile-dropdown-content .footer a:hover,
      .profile-dropdown-content .footer a:focus-visible {
        text-decoration: underline;
        outline-offset: 2px;
        outline: 2px solid currentColor;
      }
      .l-navbar.collapsed .profile-dropdown-content .footer {
        display: none;
      }

      /* Responsifitas */
      @media (min-width: 768px) {
        /* Desktop */
        body {
          margin-left: var(--nav-width);
          overflow-x: hidden;
        }

        .l-navbar {
          left: 0;
          padding: 1rem;
        }

        .l-navbar.collapsed {
          left: 0;
        }

        .main-wrapper {
          margin-left: var(--nav-width);
          overflow-x: hidden;
        }

        .main-wrapper.shifted-collapsed {
          margin-left: var(--nav-width-collapsed);
        }

        /* Sembunyikan mobile-top-toggle di desktop */
        .mobile-top-toggle {
          display: none !important;
        }

        /* Tampilkan Admin Panel text dan icon toggle di desktop */
        .nav_logo {
          justify-content: space-between;
          cursor: pointer;
        }
        .nav_logo .admin-panel-text {
          display: inline-block;
          opacity: 1;
          width: auto;
        }
        .nav_logo .bx-menu {
          display: block;
          margin-left: 0;
          margin-right: 0;
        }

        /* Khusus saat desktop collapsed */
        .l-navbar.collapsed .nav_logo {
          justify-content: center;
        }

        /* Pastikan konten utama tidak scroll horizontal di desktop */
        .main-content {
          overflow-x: hidden;
        }

        /* Profile Dropdown positioning for desktop */
        .profile-dropdown-content {
          position: absolute;
          top: auto;
          bottom: 100%;
          left: 0;
          width: 100%;
          border-radius: var(--profile-menu-radius);
        }

        /* When sidebar is collapsed */
        .l-navbar.collapsed .profile-dropdown-content {
          bottom: unset;
          top: 0;
          left: var(--nav-width-collapsed);
          width: var(--nav-width);
          border-radius: var(--profile-menu-radius);
          /* Pastikan border dan glassmorphism tetap konsisten saat floating */
          border: 1px solid rgba(255, 255, 255, 0.15); /* Border saat collapsed floating */
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); /* Shadow yang terlihat saat floating */
          /* backdrop-filter untuk collapsed state akan ditangani oleh body.dark-mode class */
          /* Jadi tidak perlu di set none disini jika ingin tetap glass di dark mode collapsed */
        }
        /* Tambahkan aturan khusus untuk backdrop-filter di dark mode collapsed jika diperlukan,
           tapi aturan body.dark-mode .profile-dropdown-content sudah cukup */

        /* To prevent text overflow on profile card in collapsed state, though we hide it. */
        .l-navbar.collapsed .profile-card h2,
        .l-navbar.collapsed .profile-card p {
          display: none;
        }
      }

      @media (max-width: 767px) {
        /* Mobile */
        body {
          margin-left: 0 !important;
          overflow-x: auto;
        }
        .l-navbar {
          left: -250px;
          padding-top: 1rem;
          overflow: hidden;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          height: 100vh;
        }
        .l-navbar.show {
          left: 0;
          width: var(--nav-width);
        }
        .main-wrapper {
          margin-left: 0 !important;
          overflow-x: auto;
        }
        .main-wrapper.shifted,
        .main-wrapper.shifted-collapsed {
          margin-left: 0 !important;
        }

        /* Tampilkan mobile-top-toggle di mobile */
        .mobile-top-toggle {
          display: flex !important;
        }

        /* Sembunyikan Admin Panel text dan icon toggle di dalam sidebar di mobile */
        .nav_logo {
          display: none !important;
        }

        /* Izinkan konten utama untuk scroll horizontal di mobile jika diperlukan */
        .main-content {
          overflow-x: auto;
        }

        .nav {
          flex-grow: 1;
          display: flex;
          flex-direction: column;
          height: 100%;
          justify-content: space-between;
          height: 100%; /* Full height for mobile */
        }
        .nav > div:first-child {
          display: flex;
          flex-direction: column;
          flex-grow: 1;
        }

        .nav_list {
          display: flex;
          flex-direction: column;
          flex-grow: 1;
        }

        /* Profile menu adjustments for mobile (when sidebar is open) */
        .l-navbar .profile-menu {
          display: none;
          width: 100%;
          margin-left: 0;
          margin-right: 0;
          padding: 1rem;
          border-radius: 0;
          box-shadow: none;
          position: relative;
          z-index: 999;
          margin-top: auto; /* Jarak dari atas */
        }

        .l-navbar.mobile-open .profile-menu {
          display: block;
          flex-direction: column;
        }

        .profile-card {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 1rem;
          border-radius: 0;
          box-shadow: none;
          background-color: transparent;
          backdrop-filter: none;
          -webkit-backdrop-filter: none;
          border: none;
          width: 100%;
          max-width: 100%;
          word-wrap: break-word;
          white-space: normal;
          overflow: hidden;
          position: relative;
        }

        .profile-card img {
          width: 56px;
          height: 56px;
        }

        .profile-card h2 {
          font-size: 0.9rem;
          margin: 0;
          line-height: 1.2;
          font-weight: 600;
          text-align: center;
        }

        .profile-card p {
          font-size: 0.75rem;
          margin: 0;
          line-height: 1.2;
          color: var(--profile-light-text-secondary);
          text-align: center;
        }

        body.dark-mode .profile-card {
          backdrop-filter: blur(8px) saturate(180%);
          -webkit-backdrop-filter: blur(8px) saturate(180%);
          border: none;
          box-shadow: none;
        }

        /* Profile dropdown content for mobile (when sidebar is open) */
        .profile-dropdown-content {
          border-radius: 0;
          box-shadow: none;
          position: relative;
          transform: none !important;
          left: 0;
          width: 100%;
          background: transparent;
          backdrop-filter: none;
          -webkit-backdrop-filter: none;
          border: none;
        }
        body.dark-mode .profile-dropdown-content {
          backdrop-filter: blur(10px) saturate(150%);
          -webkit-backdrop-filter: blur(10px) saturate(150%);
          border: none;
        }

        .profile-dropdown-content nav button,
        .profile-dropdown-content nav a {
          border-radius: 0;
          padding: 1rem;
        }
        .profile-dropdown-content .divider {
          margin: var(--profile-menu-spacing) 0;
        }
        .profile-dropdown-content .footer {
          padding-left: 1rem;
          padding-right: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="mobile-top-toggle" id="mobile-toggle-btn">
      <i class="bx bx-menu"></i>
    </div>

    <div class="l-navbar" id="nav-bar">
      <div class="nav">
        <div>
          <a href="#" class="nav_logo" id="desktop-toggle-btn">
            <span class="admin-panel-text">Admin Panel</span>
            <i class="bx bx-menu"></i>
          </a>

          <div class="nav_list">
            <a
              href="/admin/home"
              class="nav_link {% if request.path == '/admin/home' %}active{% endif %}"
            >
              <i class="bx bx-grid-alt nav_icon"></i>
              <span class="nav_name">Dashboard</span>
            </a>
            <a
              href="/admin/admin-kelola-barang"
              class="nav_link {% if request.path == '/admin/admin-kelola-barang' %}active{% endif %}"
            >
              <i class="bx bx-box nav_icon"></i>
              <span class="nav_name">Kelola Barang</span>
            </a>
            <a
              href="/admin/admin-kelola-user"
              class="nav_link {% if request.path == '/admin/admin-kelola-user' %}active{% endif %}"
            >
              <i class="bx bx-user nav_icon"></i>
              <span class="nav_name">Kelola User</span>
            </a>
            <a
              <a
              href="/admin/admin-kelola-admin"
              class="nav_link {% if request.path == '/admin/admin-kelola-admin' %}active{% endif %}"
            >
              <i class="bx bx-user nav_icon"></i>
              <span class="nav_name">Kelola Admin</span>
            </a>
            <a
              href="/admin/kelola-transaksi"
              class="nav_link {% if request.endpoint == '/admin/kelola-transaksi' %}active{% endif %}"
            >
              <i class="bx bx-transfer-alt nav_icon"></i>
              <span class="nav_name">Kelola Transaksi</span>
            </a>
          </div>
        </div>
      </div>
      <div class="profile-menu" role="region" aria-label="User profile menu">
        {% if admin %}
        <section
          class="profile-card"
          data-admin-id="{{ admin[0] }}"
          data-admin-name="{{ admin[1] }}"
          id="profile-dropdown-toggle"
          tabindex="0"
          role="button"
          aria-haspopup="true"
          aria-expanded="false"
        >
          <img
            src="{{ admin[3] or 'https://dummyimage.com/72x72/ccc/fff&text=User' }}"
            alt="Profile picture"
            width="72"
            height="72"
          />
          <h2>{{ admin[1] }}</h2>
          <!-- username -->
          <p>ADMIN ID: {{ admin[0] }}</p>
          <!-- id -->
        </section>
        {% endif %}

        <div class="profile-dropdown-content" id="profile-dropdown-content">
          <nav aria-label="Profile navigation">
            <button type="button" aria-pressed="false" class="nav_link_profile">
              <span class="material-icons" aria-hidden="true"
                >person_outline</span
              >
              <span>My Profile</span>
            </button>
            <button
              type="button"
              aria-pressed="false"
              id="email-settings-btn"
              class="nav_link_profile"
            >
              <span class="material-icons" aria-hidden="true"
                >mail_outline</span
              >
              <span>Email Settings</span>
            </button>
            <button type="button" aria-pressed="false" class="nav_link_profile">
              <span class="material-icons" aria-hidden="true">settings</span>
              <span>Settings</span>
            </button>
            <button
              type="button"
              aria-pressed="false"
              class="switch-container nav_link_profile"
              aria-label="Toggle dark mode"
            >
              <span class="material-icons" aria-hidden="true">dark_mode</span>
              <span class="switch-label">Switch to Dark</span>
              <label class="switch" for="dark-mode-toggle">
                <input
                  type="checkbox"
                  id="dark-mode-toggle"
                  aria-checked="false"
                  aria-labelledby="dark-mode-toggle-label"
                />
                <span class="slider"></span>
              </label>
            </button>
            <a href="/logout" class="nav_link_profile">
              <span class="material-icons" aria-hidden="true">logout</span>
              <span>Log Out</span>
            </a>
          </nav>
          <div class="divider" role="presentation"></div>
          <footer class="footer" aria-label="Legal and policy links">
            <a href="#" tabindex="0">Privacy Policy</a> &bull;
            <a href="#" tabindex="0">Terms of Service</a>
          </footer>
        </div>
      </div>
    </div>

    <div class="overlay" id="body-overlay"></div>

    <div class="main-wrapper" id="main-wrapper">
      <div class="main-content container">
        {% block content %}
        <h2 style="color: #333">Selamat Datang di Dashboard Admin!</h2>
        <p style="color: #555">Ini adalah area utama Anda.</p>
        {% endblock %}
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const mobileToggle = document.getElementById("mobile-toggle-btn");
        const desktopToggle = document.getElementById("desktop-toggle-btn");

        const nav = document.getElementById("nav-bar");
        const wrapper = document.getElementById("main-wrapper");
        const overlay = document.getElementById("body-overlay");

        const profileDropdownToggle = document.getElementById(
          "profile-dropdown-toggle"
        );
        const profileDropdownContent = document.getElementById(
          "profile-dropdown-content"
        );

        let isSidebarOpenDesktop = true;

        function updateUI() {
          if (window.innerWidth >= 768) {
            nav.classList.remove("show");
            overlay.classList.remove("active");

            if (isSidebarOpenDesktop) {
              nav.classList.remove("collapsed");
              wrapper.classList.remove("shifted-collapsed");
              wrapper.classList.add("shifted");
            } else {
              nav.classList.add("collapsed");
              wrapper.classList.remove("shifted");
              wrapper.classList.add("shifted-collapsed");
            }
          } else {
            nav.classList.remove("collapsed");
            wrapper.classList.remove("shifted", "shifted-collapsed");

            if (nav.classList.contains("show")) {
              overlay.classList.add("active");
            } else {
              overlay.classList.remove("active");
            }
          }
        }

        if (mobileToggle) {
          mobileToggle.addEventListener("click", () => {
            if (window.innerWidth < 768) {
              nav.classList.toggle("show");
              nav.classList.toggle("mobile-open");
              updateUI();
            }
          });
        }

        if (desktopToggle) {
          desktopToggle.addEventListener("click", (e) => {
            e.preventDefault();
            if (window.innerWidth >= 768) {
              isSidebarOpenDesktop = !isSidebarOpenDesktop;
              updateUI();
              // Close profile dropdown when sidebar collapses/expands
              profileDropdownContent.classList.remove("active");
              profileDropdownToggle.setAttribute("aria-expanded", "false");
            }
          });
        }

        overlay.addEventListener("click", () => {
          if (window.innerWidth < 768) {
            if (isOpen) {
              nav.classList.remove("mobile-open", "show");
            } else {
              nav.classList.add("mobile-open", "show");
            }
            updateUI();
          }
        });

        updateUI();

        window.addEventListener("resize", () => {
          if (window.innerWidth >= 768) {
            if (
              nav.classList.contains("show") ||
              nav.classList.contains("collapsed")
            ) {
              isSidebarOpenDesktop = true;
            }
            nav.classList.remove("show");
          } else {
            nav.classList.remove("show");
          }
          updateUI();
          // Ensure profile dropdown closes on resize if it's open, to recalculate position
          profileDropdownContent.classList.remove("active");
          profileDropdownToggle.setAttribute("aria-expanded", "false");
        });

        // Profile Dropdown Toggle Logic
        profileDropdownToggle.addEventListener("click", (event) => {
          event.stopPropagation(); // Prevent click from bubbling up to document and immediately closing

          if (window.innerWidth >= 768) {
            // Desktop
            if (nav.classList.contains("collapsed")) {
              // Sidebar is collapsed, click profile to expand sidebar
              isSidebarOpenDesktop = true;
              updateUI();
              // Ensure profile menu is closed (it shouldn't have opened)
              profileDropdownContent.classList.remove("active");
              profileDropdownToggle.setAttribute("aria-expanded", "false");
            } else {
              // Sidebar is expanded, click profile to toggle menu
              const isExpanded =
                profileDropdownContent.classList.contains("active");
              profileDropdownContent.classList.toggle("active");
              profileDropdownToggle.setAttribute("aria-expanded", !isExpanded);
            }
          } else {
            // Mobile
            if (nav.classList.contains("show")) {
              // Sidebar is open on mobile, click profile to toggle menu
              const isExpanded =
                profileDropdownContent.classList.contains("active");
              profileDropdownContent.classList.toggle("active");
              profileDropdownToggle.setAttribute("aria-expanded", !isExpanded);
            }
            // If sidebar is closed on mobile, do nothing when profile is clicked
            // The mobile-top-toggle button handles opening the sidebar.
          }
        });

        // Close dropdown when clicking outside
        document.addEventListener("click", (event) => {
          // Check if the click is outside the profile-menu container itself
          const profileMenuContainer =
            profileDropdownToggle.closest(".profile-menu");
          if (
            profileMenuContainer &&
            !profileMenuContainer.contains(event.target)
          ) {
            profileDropdownContent.classList.remove("active");
            profileDropdownToggle.setAttribute("aria-expanded", "false");
          }
        });

        // Script to toggle dark mode and update ARIA attributes (from profile menu)
        const darkModeToggle = document.getElementById("dark-mode-toggle");
        const body = document.body;

        function setDarkMode(enabled) {
          if (enabled) {
            body.classList.add("dark-mode");
            darkModeToggle.setAttribute("aria-checked", "true");
          } else {
            body.classList.remove("dark-mode");
            darkModeToggle.setAttribute("aria-checked", "false");
          }
        }

        // Initialize dark mode based on user preference or default to off
        const prefersDarkMode =
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches;
        const savedDarkMode = localStorage.getItem("darkMode");

        if (savedDarkMode === "true") {
          setDarkMode(true);
          darkModeToggle.checked = true;
        } else if (savedDarkMode === null && prefersDarkMode) {
          setDarkMode(true);
          darkModeToggle.checked = true;
        } else {
          setDarkMode(false);
          darkModeToggle.checked = false;
        }

        darkModeToggle.addEventListener("change", (e) => {
          setDarkMode(e.target.checked);
          localStorage.setItem("darkMode", e.target.checked); // Save preference
        });

        // Optional: Manage active buttons for accessibility (from profile menu, adapted for nav_link_profile)
        const navProfileItems = document.querySelectorAll(
          ".profile-dropdown-content nav button, .profile-dropdown-content nav a"
        );

        navProfileItems.forEach((item) => {
          item.addEventListener("click", () => {
            // Remove 'active' from all profile menu items
            navProfileItems.forEach((btn) => {
              btn.classList.remove("active");
              if (btn.tagName === "BUTTON") {
                btn.setAttribute("aria-pressed", "false");
              }
            });
            // Add 'active' to the clicked item
            item.classList.add("active");
            if (item.tagName === "BUTTON") {
              item.setAttribute("aria-pressed", "true");
            }
          });
        });
      });
    </script>
  </body>
</html>
